# ------------------------------------------------------------------
#          GitHub Actions Workflow: Deploy Website to cPanel
# ------------------------------------------------------------------
# ... (Header and comments are the same) ...

name: Deploy Website to cPanel

# ... (env block is the same) ...
env:
  REMOTE_HOST: "92.205.191.221"          # <-- Replace with your server's IP or domain
  REMOTE_USER: "micorptrd"           # <-- Replace with your cPanel username
  REMOTE_PORT: "22"                  # <-- Replace with your SSH port (often 22 or another custom port)
  REMOTE_TARGET_DIR: "public_html/MiCorp"        # <-- Replace with the destination folder on your server (e.g., public_html, or a subfolder)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4

      # THIS STEP IS NEW - IT IS REQUIRED FOR THE DEPLOY ACTION
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      # -------------------------------------------------
      #   FIXED: Using a dedicated rsync deploy action
      # -------------------------------------------------
      # This action is more robust and handles compatibility issues.
      # It uses the SSH key you already configured.
      - name: Sync files to server
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          # Type of transfer
          server: ${{ env.REMOTE_HOST }}
          username: ${{ env.REMOTE_USER }}
          password: ${{ secrets.DEPLOY_KEY }} # Use the same secret for the SSH key
          port: ${{ env.REMOTE_PORT }}
          
          # Deployment settings
          protocol: sftp # Use SFTP protocol, which uses SSH
          local-dir: ./ # Sync the entire repository
          server-dir: ${{ env.REMOTE_TARGET_DIR }}/
          
          # Sync options
          delete: true # Deletes files on the server that are not in the repo
          exclude: |   # List of files/directories to exclude
            **/.git*
            **/.github*
            **/README.md
